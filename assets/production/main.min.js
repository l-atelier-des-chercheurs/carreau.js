var setFixedForSlides=function(){function e(e){return!e.isFixed&&(e.el.classList.add("is--pinned"),e.isFixed=!0,!0)}function n(e){return!!e.isFixed&&(e.el.classList.remove("is--pinned"),e.isFixed=!1,!0)}function t(e){e.isFar||(e.el.classList.add("is--far"),e.isFar=!0)}function o(e){e.isFar&&(e.el.classList.remove("is--far"),e.isFar=!1)}function r(e){for(c=[],i=0;i<e.length;i++)c[i]={el:e[i]},c[i].bounds=c[i].el.getBoundingClientRect(),c[i].bounds.offsetTop=c[i].bounds.top+window.pageYOffset}function d(){if(l===window.pageYOffset)return a(d),!1;var r=window.pageYOffset-l;for(l=window.pageYOffset,i=0;i<c.length;i++)if(window.pageYOffset+r>=c[i].bounds.offsetTop){var f=e(c[i]);if(f){console.log("Just made slide number "+i+" fixed.");var p=i-u;console.log("Will try to hide slide number "+p+"."),p>=0&&t(c[p])}}else{var g=n(c[i]);if(g){var m=i-u;m>=0&&o(c[m])}}s&&a(d)}var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},s=!1,u=2,c=[],l=-1;return{init:function(e){r(e),s=!0,d()},stop:function(){s=!1}}}(),currentStream=function(){function e(e){var n=h.map(function(e){return e.value});h.forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)});for(var t=store.get(S),o=store.get(R),i=0;i!==e.length;++i){var r=e[i],d=r.deviceId,a=document.createElement("option");a.value=d,d!==t&&d!==o||(a.selected=!0),"audioinput"===r.kind?(a.text=r.label||"microphone "+(g.length+1),g.appendChild(a)):"audiooutput"===r.kind?(a.text=r.label||"speaker "+(m.length+1),m.appendChild(a)):"videoinput"===r.kind?(a.text=r.label||"camera "+(v.length+1),v.appendChild(a)):console.log("Some other kind of source/device: ",r)}h.forEach(function(e,t){Array.prototype.slice.call(e.childNodes).some(function(e){return e.value===n[t]})&&(e.value=n[t])})}function n(){for(index=0;index<w.length;index++)if(w[index].checked)return w[index].dataset}function t(){console.log(y);var e=store.get(y);if(void 0!==e)for(index=0;index<w.length;index++)e.width===w[index].dataset.width&&e.height===w[index].dataset.height?w[index].checked=!0:w[index].checked=!1}function o(e,n){"undefined"!=typeof e.sinkId?e.setSinkId(n).then(function(){console.log("Success, audio output device attached: "+n)}).catch(function(e){var n=e;"SecurityError"===e.name&&(n="You need to use HTTPS for selecting audio output device: "+e),console.error(n),m.selectedIndex=0}):console.warn("Browser does not support output device selection.")}function i(){var e=m.value;o(l,e)}function r(){console.log("setting new sources for audio and video feeds");var e=g.value,t=v.value;store.set(S,t),store.set(R,e);var o=n();store.set(y,o),C={audio:{optional:[e?{sourceId:e}:void 0]},video:{optional:[t?{sourceId:t}:void 0],mandatory:{minWidth:o.width,minHeight:o.height}}},l.paused||currentStream.startCameraFeed()}function d(){return new Promise(function(e,n){console.log("Getting camera feed"),void 0!==C&&void 0!==C.video||n("Camera not yet ready"),navigator.getUserMedia({video:C.video,audio:!1},function(n){e(n)},function(e){alert(settings.lang.videoStreamCouldntBeStartedTryChangingRes+"\n\n error: "+JSON.stringify(e))})})}function a(){return new Promise(function(e,n){void 0!==C&&void 0!==C.audio||n("audio devices not yet ready"),console.log("Getting audio feed"),navigator.getUserMedia({video:!1,audio:C.audio},function(n){e(n)},function(e){alert(dodoc.lang.audioStreamCouldntBeStarted+"\n\n error: "+JSON.stringify(e))})})}var s,u,c,l,f,p,g,m,v,h,w,F,x,S,R,y,C;return{init:function(){return s=$(".js--popover_cameraFeed"),u=$(".js--popover_cameraFeed_settingsPane"),c=$(".js--toggleCameraSettings"),l=document.querySelector(".js--videoFeed"),g=document.querySelector(".js--audioSource"),m=document.querySelector(".js--audioOutput"),v=document.querySelector(".js--videoSource"),h=[g,m,v],w=document.querySelector(".js--resolutionSelector").videoRes,S="selectedVideoDeviceId",R="selectedAudioDeviceId",y="selectedVideoRes",c.click(function(){$(document).trigger("toggle_settings_pane")}),$(document).on("toggle_settings_pane",function(){u.offset().top>=$(window).innerHeight()-50?$(s).animate({scrollTop:u.outerHeight()},600,$.easing.easeInOutQuint):$(s).animate({scrollTop:0},600,$.easing.easeInOutQuint)}),t(),void 0===store.get(S)&&$(document).trigger("open_settings_pane"),new Promise(function(n,t){navigator.mediaDevices.enumerateDevices().then(function(t){e(t),r(),g.onchange=r,m.onchange=i,v.onchange=r,$(w).change(r),n()},function(e){t("Failed to init stream : "+e)})})},getVideoFrame:function(){return l},stopAllFeeds:function(){l.paused||l.pause(),f&&f.getTracks().forEach(function(e){e.stop()}),p&&p.getTracks().forEach(function(e){e.stop()})},startCameraFeed:function(){return new Promise(function(e,n){currentStream.stopAllFeeds(),d().then(function(n){if(f=n,navigator.mozGetUserMedia)l.mozSrcObject=n;else{var t=window.URL||window.webkitURL;l.src=t.createObjectURL(n)}l.play(),e()},function(e){console.log(" failed to start camera feed: "+e),n("failed to start camera feed")})})},startRecordCameraFeed:function(){return new Promise(function(e,t){d().then(function(t){var o=n();F=new RecordRTC(t,{type:"video",canvas:{width:o.width,height:o.height}}),F.startRecording(),e()},function(e){console.log(" failed to start camera feed: "+e),t()})})},stopRecordCameraFeed:function(){return new Promise(function(e,n){void 0!==F&&F.stopRecording(function(){F.getDataURL(function(n){e(n)})})})},getAudioStream:function(){},startAudioFeed:function(){return new Promise(function(e,n){currentStream.stopAllFeeds(),a().then(function(n){p=n,e(n)},function(){console.log(" failed to get audio feed"),n()})})},startRecordAudioFeed:function(){return new Promise(function(e,n){a().then(function(n){x=new RecordRTC(n,{type:"audio"}),x.startRecording(),e()},function(){console.log(" failed to start audio recording"),n()})})},stopRecordAudioFeed:function(){return new Promise(function(e,n){void 0!==x&&x.stopRecording(function(n){x.getDataURL(function(n){e(n)})})})}}}(),popup=function(){function e(e){e.find(".js--closePopup").on("click",function(){$(this).closest(".js--textContent").fadeOut(300,function(){$(this).remove()}).end()}).end()}function n(n){var o=$('<div class="module--popup--textContent js--textContent"><p>'+n+'</p><button class="module--popup--closePopup js--closePopup">x</button></div>');t.append(o).show(),e(o)}var t;return{init:function(e){console.log("-- popup : init"),1===e.length&&(t=e)},displayMessage:function(e){console.log("-- popup : showing new popup msg"),n(e)}}}();console.log($(".js--popup")),popup.init($(".js--popup")),$.extend($.easing,{easeInOutQuint:function(e,n,t,o,i){return(n/=i/2)<1?o/2*n*n*n*n*n+t:o/2*((n-=2)*n*n*n*n+2)+t}});